#!/bin/sh

PID_FILE="/run/hwclock.pid"

case "$1" in
	start)
		if [ -f "$PID_FILE" ] && kill -0 "$(cat "$PID_FILE")" 2>/dev/null; then
			echo "Already running"
			exit 0
		fi
		(
			while true; do
				hwclock -a
				sleep 3600
			done
		) &
		echo $! >"$PID_FILE"
		;;
	stop)
		if [ -f "$PID_FILE" ]; then
			PID=$(cat "$PID_FILE")
			if kill -0 "$PID" 2>/dev/null; then
				kill "$PID"
				rm -f "$PID_FILE"
				echo "Stopped"
			else
				echo "Not running"
				rm -f "$PID_FILE"
			fi
		else
			echo "No PID file"
		fi
		;;
	restart | reload)
		stop
		start
		;;
	*)
		echo "Usage: $0 {start|stop|restart|reload}"
		exit 1
		;;
esac

exit 0
